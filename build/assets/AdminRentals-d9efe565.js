import"./base-40151e19.js";import{E as le,a as ae}from "./el-table-column-d728468a.js";import"./el-checkbox-8f2d8563.js";import"./el-tooltip-fe7a3ae3.js";import"./el-scrollbar-4d76fa87.js";import{E as te}from "./el-button-7a3e83ea.js";/* empty css               */import{E as oe}from "./el-date-picker-570f40ab.js";import{E as se}from "./el-input-5a2c3fae.js";/* empty css                  */import{r as o,k as re,o as ne,a as u,c as h,b as t,d as s,l as d,t as c,i as $,F as S,m as D,q as C,j as w,u as N,s as ie}from "./app-417fc4a4.js";import{d as ue}from "./index-5c14bedf.js";/* empty css                    */import{h as U}from "./moment-a9aaa855.js";import{E as de,a as ce}from "./index-7afdeace.js";import"./objects-a3f7d715.js";import"./_initCloneObject-5d6a36d4.js";import"./isArrayLikeObject-38992b29.js";import"./_baseIteratee-ab40514f.js";import"./flatten-66fc93b5.js";import"./index-e7076969.js";import"./use-global-config-2834e396.js";import"./typescript-8048a034.js";import"./scroll-b0cd01fe.js";import"./validator-3cef17f7.js";const pe={class:"card"},me={class:"card-body"},ve={class:"row"},_e={class:"formbold-mb-3 col-md-2"},fe=t("label",{class:"formbold-form-label"},"Country",-1),ge={class:"formbold-mb-3 col-md-2"},be=t("label",{class:"formbold-form-label"},"Suppliers",-1),ye={class:"formbold-mb-3 col-md-2"},he=t("label",{class:"formbold-form-label"},"Status",-1),we={class:"formbold-mb-3 col-md-2"},xe=t("label",{class:"formbold-form-label"},"Rental Reference",-1),ke={class:"col-md-3 date-input"},Ce={class:""},Ve=t("label",{class:"formbold-form-label"},"Select Date Range",-1),$e=t("h2",{class:"mb-4"},"Rentals",-1),Se={class:"d-flex"},Ee={key:0,class:"col-md-4 mt-5 offset-3"},De={class:"text-muted text-sm-end"},Re={class:"table align-middle table-nowrap table-centered mb-0"},Te=t("thead",null,[t("tr",null,[t("th",{style:{width:"250px"}},"Number of rentals"),t("th",{style:{width:"250px"}},"To be paid"),t("th",{style:{width:"250px"}},"Currency")])],-1),Ye={style:{width:"250px"}},Pe={style:{width:"250px"}},ze={style:{width:"250px"}},Ae={key:0,class:"row ml-5 mt-5"},il={__name:"AdminRentals",setup(Be){const y=o(""),i=o("");o("");const _=o(""),f=o(""),m={loading:o(!1),all:o([]),list:o([]),options:o([])},p={loading:o(!1),all:o([]),list:o([]),options:o([])};o(!1),o([]),o([]),o([]);const x={loading:o(!1),all:o([]),list:o([]),options:o([])},v=o(""),R=o(""),V=o([]),g=o(!1),T=o(""),k=o({}),q=ue.useToast(),M=async()=>{m.loading.value=!0;try{const a=await axios.get("/get/countries",{});m.all.value=a.data,console.log(a),m.list.value=m.all.value.map(l=>({id:`${l}`,label:`${l}`,iso:`${l}`}))}catch(a){console.error(a)}finally{m.loading.value=!1}},L=()=>{i.value="",y.value="",b()},F=async()=>{try{p.loading.value=!0,y.value&&(await axios.post("/rentals/reconcile",{supplier_id:i.value})).data.status&&(q.success("Supplier Rentals Reconciled Successfully",{position:"top"}),b())}catch(a){console.error(a)}finally{p.loading.value=!1}},I=async()=>{try{if(p.loading.value=!0,y.value){const a=await axios.get("/get/suppliers",{params:{country:y.value}});p.all.value=a.data,p.list.value=p.all.value.map(l=>({value:`${l.name}`,label:`${l.name}`,id:`${l.id}`}))}}catch(a){console.error(a)}finally{p.loading.value=!1}},O=()=>{b()},j=async()=>{try{const a=await axios.get("/get/supplier/invoice",{params:{company_id:i.value}});k.value=a.data.data,b()}catch(a){console.error(a)}},G=async()=>{try{const a=await axios.get("/get/user/role");T.value=a.data}catch(a){console.error(a)}},b=async()=>{try{g.value=!0;const a={supplier_id:"",order_status:"",order_number:"",date_range:""};(i.value!==[]||i.value!=null||i.value!==void 0||i.value!=="")&&(a.supplier_id=i.value),(v.value!==[]||v.value!=null||v.value!==void 0||v.value!=="")&&(a.order_status=v.value),(_.value!==[]||_.value!=null||_.value!==void 0||_.value!=="")&&(a.order_number=_.value),(f.value!==[]||f.value!=null||f.value!==void 0||f.value!=="")&&(a.date_range=f.value);const l=await axios.get("/get/rentals/admin",{params:a});V.value=l.data.rentals,x.all.value=l.data.rental_statuses,x.list.value=x.all.value.map(r=>({value:`${r.name_en}`,label:`${r.name_en}`,id:`${r.id}`})),x.loading.value=!1}catch(a){console.error(a)}finally{g.value=!1}},H=re(()=>V.value.filter(a=>!R.value||a.vehicle.name.toLowerCase().includes(R.value.toLowerCase()))),J=async(a, l)=>{try{g.value=!0;const r=await axios.post("accept/rentals",l);V.value=r.data}catch(r){console.error(r)}finally{g.value=!1}},K=async(a, l)=>{try{g.value=!0;const r=await axios.post("delete/rentals",l);V.value=r.data}catch(r){console.error(r)}finally{g.value=!1}},Q=async()=>{let a=new URLSearchParams(window.location.search);a.has("status")&&(v.value=a.get("status"))};return ne(()=>{Q(),G(),b(),M()}),(a, l)=>{var P,z,A,B;const r=ce,E=de,W=se,X=oe,n=ae,Y=te,Z=le;return u(),h(S,null,[t("div",pe,[t("div",me,[t("div",ve,[t("div",_e,[fe,s(E,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]= e=>y.value=e),size:"large",filterable:"",remote:"","reserve-keyword":"",placeholder:"Countries...","remote-show-suffix":"",loading:m.loading.value,onChange:l[1]||(l[1]= e=>I()),required:""},{default:d(()=>[(u(!0),h(S,null,D(m.list.value, e=>(u(),C(r,{key:e.id,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",ge,[be,s(E,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]= e=>i.value=e),size:"large",filterable:"",remote:"",style:{height:"35px"},"reserve-keyword":"",onChange:l[3]||(l[3]= e=>j()),placeholder:"Suppliers...","remote-show-suffix":"",loading:p.loading.value,required:""},{default:d(()=>[(u(!0),h(S,null,D(p.list.value, e=>(u(),C(r,{key:e.id,label:e.label,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",ye,[he,s(E,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]= e=>v.value=e),size:"large",filterable:"",remote:"","reserve-keyword":"",placeholder:"Rental Status...","remote-show-suffix":"",style:{height:"35px"},loading:m.loading.value,onChange:l[5]||(l[5]= e=>O()),required:""},{default:d(()=>[(u(!0),h(S,null,D(x.all.value, e=>(u(),C(r,{key:e.id,label:e.name_en,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",we,[xe,s(W,{placeholder:"Reference...",modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]= e=>_.value=e),onChange:l[7]||(l[7]= e=>b()),style:{height:"35px"}},null,8,["modelValue"])]),t("div",ke,[t("div",Ce,[Ve,s(X,{modelValue:f.value,"onUpdate:modelValue":l[8]||(l[8]= e=>f.value=e),type:"daterange","range-separator":"TO","start-placeholder":"Start date","end-placeholder":"End date",size:"large",required:"true",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",style:{height:"35px"},onChange:b},null,8,["modelValue"])])])]),$e,t("div",Se,[s(Z,{data:H.value,style:{width:"100%"},loading:g.value,stripe:""},{default:d(()=>[s(n,{align:"left",label:"Booking #",prop:"order_number"}),s(n,{align:"left",label:"Vehicle",prop:"vehicle.name"}),s(n,{align:"left",label:"Customer Name",prop:"customer.name"}),s(n,{align:"left",label:"Country",prop:"customer.country"}),s(n,{align:"left",label:"Total Price",prop:"price"},{default:d(e=>[w(c(e.row.price)+" "+c(e.row.currency),1)]),_:1}),s(n,{align:"left",label:"Profit",prop:"profit_margin"},{default:d(e=>[w(c(e.row.profit_margin)+"% ",1)]),_:1}),s(n,{align:"left",label:"Supplier price",prop:"supplier_price"},{default:d(e=>[w(c(e.row.supplier_price)+" "+c(e.row.currency),1)]),_:1}),s(n,{align:"left",label:"Supplier name",prop:"vehicle.supplier.name"}),s(n,{align:"left",label:"Rental Status",prop:"status.name_en"}),s(n,{align:"left",label:"Started At",prop:"start_date"}),s(n,{align:"left",label:"Ended At",prop:"end_date"}),s(n,{align:"left",label:"Duration",prop:"start_date"},{default:d(e=>[w(c(N(U)(e.row.end_date).diff(N(U)(e.row.start_date),"days")),1)]),_:1}),s(n,{align:"right"},ie({_:2},[T.value==="active_supplier"?{name:"default",fn:d(e=>[e.row.order_status===0?(u(),C(Y,{key:0,size:"small",type:"success",onClick: ee=>J(e.$index,e.row)},{default:d(()=>[w("Activate ")]),_:2},1032,["onClick"])):$("",!0),e.row.order_status===0||e.row.order_status===1?(u(),C(Y,{key:1,size:"small",type:"danger",onClick: ee=>K(e.$index,e.row)},{default:d(()=>[w(c(e.row.order_status===0?"Delete":e.row.order_status===1?"Disable":""),1)]),_:2},1032,["onClick"])):$("",!0)]),key:"0"}:void 0]),1024)]),_:1},8,["data","loading"])])])]),i.value?(u(),h("div",Ee,[t("div",De,[t("table",Re,[Te,t("tbody",null,[t("tr",null,[t("td",Ye,c((P=k.value)==null?void 0:P.count_rentals),1),t("td",Pe,[t("div",null,c((z=k.value)==null?void 0:z.total_price),1)]),t("td",ze,c((A=k.value)==null?void 0:A.currency),1)])])])]),((B=k.value)==null?void 0:B.total_price)>0?(u(),h("div",Ae,[t("a",{onClick:l[9]||(l[9]= e=>F()),class:"col-2 text-white btn btn-success mr-5"},"Pay"),t("a",{onClick:l[10]||(l[10]= e=>L()),class:"col-2 btn btn-danger text-white"},"Cancel")])):$("",!0)])):$("",!0)],64)}}};export{il as default};
