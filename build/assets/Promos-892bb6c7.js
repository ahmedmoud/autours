import"./base-006c1490.js";import{E as J}from"./el-checkbox-5300d020.js";import{E as K}from"./el-input-6a853cb5.js";/* empty css               *//* empty css                  */import"./el-scrollbar-3fe9b6f7.js";import{E as Q,a as X}from"./el-table-column-716264cc.js";import"./el-tooltip-66a73e45.js";import{r as a,k as T,o as Y,a as c,c as _,b as t,d as s,l as n,i as A,f as Z,N as ee,j as O,t as S,F as P,m as E,q as L}from"./app-30bfa28d.js";import{d as le}from"./index-730c8ef6.js";/* empty css                    */import{E as oe,a as ae}from"./index-9021004d.js";import"./objects-59c3839e.js";import"./_baseIteratee-287b9fba.js";import"./flatten-d513a695.js";import"./typescript-3a767c6c.js";import"./_initCloneObject-c174f230.js";import"./isArrayLikeObject-f1e7b3e7.js";import"./index-ee9cdf57.js";import"./scroll-f882c87e.js";import"./validator-0602e0e9.js";const te={class:"card"},se={class:"card-body"},re=t("h2",{class:"mb-4"},"Promos",-1),ne={class:"card"},ie={class:"card-body"},de=["disabled","value"],ce=["onClick"],ue={key:0},ve=t("hr",null,null,-1),me=t("h2",null,"Select Vehicle",-1),pe={class:"card"},_e={class:"row p-3"},he={class:"formbold-mb-3 col-md-2"},be=t("label",{class:"formbold-form-label"},"Country",-1),fe={class:"formbold-mb-3 col-md-2"},ge=t("label",{class:"formbold-form-label"},"Branches",-1),ye={class:"formbold-mb-3 col-md-2"},we=t("label",{class:"formbold-form-label"},"Vehicles",-1),Ve={class:"d-flex",style:{gap:"10px"}},Ce=["src"],xe=t("hr",null,null,-1),ke={class:"card-body"},$e=["src"],Ke={__name:"Promos",setup(Pe){const C=le.useToast(),d=a(""),D=a([]),h=a([]),u=a(!1),v=a(""),i=a([]),y=a([]),m={loading:a(!1),all:a([]),list:a([]),options:a([])};a(!1),a([]),a([]),a([]);const b={loading:a(!1),all:a([]),list:a([]),options:a([])},f={loading:a(!1),all:a([]),list:a([]),options:a([])},g=a(""),p=a(""),w=a(""),U=async()=>{try{u.value=!0;const l=await axios.get("get/included");D.value=l.data,console.log(l.data)}catch(l){console.error(l)}finally{u.value=!1}},q=async l=>{await axios.delete("/promo/"+l),window.location.reload()},z=async()=>{try{if(v.value===[]||v.value===void 0||v.value===null){C.error("Please select promo first form whats included",{position:"top"});return}if(i.value.length===0){C.error("Please select Vehicles to apply the promo on",{position:"top"});return}const l=new FormData;l.set("included_id",v.value),l.set("selected_vehicles",i.value);const e=await axios.post("/promo",l);window.location.reload(),console.log(e)}catch(l){C.error("something went wrong"),console.error(l)}},F=l=>{var e;console.log(l),((e=i.value)==null?void 0:e.indexOf(l))>=0?i.value.splice(i.value.indexOf(l),1):i.value.push(l),console.log(i.value)},I=T(()=>{if(typeof d.value=="string")return D.value.filter(l=>!d.value||l.what_is_included!=null||l.what_is_included.toLowerCase().includes(d.value.toLowerCase()));d.value=""}),M=T(()=>(Array.isArray(h.value)?h.value:[]).filter(e=>!d.value||!p.value||e.vehicle_name&&e.vehicle_name.toLowerCase().includes(d.value.toLowerCase())||e.vehicle_name&&e.vehicle_name.toLowerCase().includes(p.value.toLowerCase())||e.branch_name&&e.branch_name.toLowerCase().includes(d.value.toLowerCase())||e.branch_country&&e.branch_country.toLowerCase().includes(d.value.toLowerCase()))),R=async()=>{try{u.value=!0;const l=await axios.get("/promo");console.log(l.data),y.value=l.data}catch(l){console.error(l)}finally{u.value=!1}},B=async l=>{try{u.value=!0;const e={};p.value&&(e.country=p.value),w.value&&(e.supplier=w.value),g.value&&(e.branch=g.value),i.value&&(e.selectedVehicles=i.value);const r=await axios.get("/get/profit",{params:e});h.value=r.data.data,w.value=r.data.supplier_id;for(const V in h.value[l])data.value[V]=h.value[l][V]||""}catch(e){console.error(e)}finally{u.value=!1}},W=async()=>{try{const l=await axios.get("get/branches",{params:{company_id:w.value,country:p.value}});b.all.value=l.data,b.list.value=b.all.value.map(e=>({value:`${e.name}`,label:`${e.name}`,id:`${e.id}`}))}catch(l){console.error(l)}},j=async()=>{try{const l=await axios.get("get/vehicles",{params:{branch_id:g.value}});f.all.value=l.data,f.list.value=f.all.value.map(e=>({value:`${e.name}`,label:`${e.name}`,id:`${e.id}`,photo:`${e.photo}`}))}catch(l){console.error(l)}},G=async()=>{m.loading.value=!0;try{const l=await axios.get("/get/countries",{});m.all.value=l.data,console.log(l),m.list.value=m.all.value.map(e=>({id:`${e}`,label:`${e}`,iso:`${e}`}))}catch(l){console.error(l)}finally{m.loading.value=!1}};return Y(()=>{U(),B(),R(),G()}),(l,e)=>{const r=X,V=K,N=Q,x=ae,k=oe,H=J;return c(),_("div",te,[t("div",se,[re,t("div",ne,[t("div",ie,[s(N,{data:I.value,loading:u.value,stripe:""},{default:n(()=>[s(r,{label:"Select Promotion"},{default:n(o=>[Z(t("input",{disabled:y.value.indexOf(o.row.id)>-1,type:"radio",value:o.row.id,"onUpdate:modelValue":e[0]||(e[0]=$=>v.value=$)},null,8,de),[[ee,v.value]])]),_:1}),s(r,{label:"What is included?",prop:"what_is_included"}),s(r,{label:"Is Promoted ?"},{default:n(o=>[O(S(y.value.indexOf(o.row.id)>-1?"Promoted":"Not Promoted"),1)]),_:1}),s(r,{align:"center"},{header:n(()=>[s(V,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),_:1}),s(r,null,{default:n(o=>[y.value.indexOf(o.row.id)>-1?(c(),_("button",{key:0,class:"btn btn-danger",onClick:$=>q(o.row.id)}," Remove promo",8,ce)):A("",!0)]),_:1})]),_:1},8,["data","loading"])])]),v.value?(c(),_("div",ue,[ve,me,t("div",pe,[t("div",_e,[t("div",he,[be,s(k,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=o=>p.value=o),size:"large",filterable:"",remote:"","reserve-keyword":"",placeholder:"Countries...","remote-show-suffix":"",loading:m.loading.value,onChange:e[3]||(e[3]=o=>W()),required:""},{default:n(()=>[(c(!0),_(P,null,E(m.list.value,o=>(c(),L(x,{key:o.id,label:o.label,value:o.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",fe,[ge,s(k,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),size:"large",filterable:"",remote:"","reserve-keyword":"",onChange:e[5]||(e[5]=o=>j()),placeholder:"Branches...","remote-show-suffix":"",loading:b.loading.value,required:""},{default:n(()=>[(c(!0),_(P,null,E(b.list.value,o=>(c(),L(x,{key:o.id,label:o.label,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",ye,[we,s(k,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value=o),size:"large",filterable:"",remote:"",multiple:"","reserve-keyword":"",placeholder:"Vehicles...","remote-show-suffix":"",loading:f.loading.value,required:""},{default:n(()=>[(c(!0),_(P,null,E(f.list.value,o=>(c(),L(x,{key:o.id,label:o.label,value:o.id},{default:n(()=>[t("div",Ve,[t("img",{src:"img/vehicles/"+o.photo,style:{width:"50px"}},null,8,Ce),O(" "+S(o.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),t("div",{class:"mt-4 col-md-1"},[t("button",{class:"mt-2 btn btn-primary col-md-12",type:"button",onClick:B},"Search")])]),xe,t("div",ke,[s(N,{data:M.value,style:{width:"100%"},loading:u.value,stripe:""},{default:n(()=>[s(r,{label:"What is included?",prop:"what_is_included"},{default:n(o=>[s(H,{value:o.row.id,onClick:$=>F(o.row.vehicle_id)},null,8,["value","onClick"])]),_:1}),s(r,{label:"Photo",prop:""},{default:n(o=>[t("img",{src:"/img/vehicles/"+o.row.photo,width:"150",height:"100"},null,8,$e)]),_:1}),s(r,{label:"Vehicle Name",prop:"vehicle_name"}),s(r,{label:"Country",prop:"branch_country"}),s(r,{label:"Branch Name",prop:"branch_name"})]),_:1},8,["data","loading"])])]),t("button",{class:"btn btn-primary",onClick:e[7]||(e[7]=o=>z())}," Add Promo")])):A("",!0)])])}}};export{Ke as default};
